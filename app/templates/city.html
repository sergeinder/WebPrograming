<!doctype html>
<html lang="en">
<head>
    <script src="https://api-maps.yandex.ru/2.0-stable/?apikey=9a9e76e0-a2b2-4150-a38d-30b776ddd95e&load=package.standard&lang=ru-RU" type="text/javascript"></script>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel ="stylesheet" href="{{ url_for('static', path='/css/header_block.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/citynum.css') }}">
    <style>
        html, body, #map {
            width: 100%; height: 100%; padding: 0; margin: 0;
        }
    </style>
    <title>Moscow</title>
</head>
<body>
    <header>
    <div class="menu">
      <a href="http://localhost:8000/pages/main">Home</a>
      <a id="youfavorite">Favorite</a>
    </div>
    <div class="account">
      <a href="http://localhost:8000/pages/login">Login</a>
      <a href="http://localhost:8000/pages/register">Register</a>
    </div>
    </header>
    
    <div class="name">
      <div class="back"></div>
      <h6>{{city.name}}</h6>
      <button type="button" id="favorite" class="active">Favorite</button>
    </div>
    <img class="panorama" src="{{url_for('static',path='images/'+city.big_photo_id|string+'.jpg')}}">
    {% for attraction in attractions %}
      <div class="card">
        <img src="{{url_for('static',path='images/'+attraction.image_id|string+'.jpg')}}" alt="attraction">
        <div class="card__text">
          <h4>{{attraction.name}}</h4>
          <h3 class="addres">Addres: {{attraction.address}}</h3>
          <p>{{attraction.description}}</p>
        </div>
      </div>
    {% endfor %}


    <!-- <div id="map"></div> -->
</body>
</html>
<script>
  const buttonf = document.getElementById('favorite');
  buttonf.addEventListener('click', async function(){
      const url = "http://localhost:8000/favourites?city_id={{city.id}}";
      let response = await  fetch(url, {method: 'POST',
                headers: {'Content-Type': 'application/json'}, 
                credentials: 'include',}
      )
      if (!response.ok) {
        window.location.href = "/pages/login"
      }
    } )
</script>

<script>
  const buttonfp = document.getElementById('youfavorite');
  buttonfp.addEventListener('click', async function(){
      const url = "http://localhost:8000/auth/me";
      let response = await  fetch(url, {
        method: 'GET',
        credentials: 'include',}
      )
      if (response.ok) {
      let data = await  response.json()
      console.log(data['id'])
      const url1 = "/pages/favourite/" + data['id']
      window.location.href = url1
      }else{
        window.location.href = "/pages/login"
      }
    } )
</script>
<script type="text/javascript">
  ymaps.ready(function () {
    var myMap = new ymaps.Map('map', {
            center: [55.777826, 37.623712],
            zoom: 12
        });
        '{% for attraction in attractions %}'
        var Placemark = new ymaps.Placemark(['{{attraction.location}}'],{iconContent: '{{attraction.name}}'},{preset: 'twirl#blueStretchyIcon'});
        myMap.geoObjects.add(Placemark);
        '{% endfor %}'
        myMap.controls.add('zoomControl');
        myMap.controls.add('typeSelector');
    });
</script>